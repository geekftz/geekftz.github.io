<!doctype html><html lang=en-us><head><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script>hljs.initHighlightingOnLoad();</script><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/images/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon-16x16.png><link rel=manifest href=/images/site.webmanifest><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A simple, minimal blog for those who love text."><title>2020-12-04-记录一次vuecli3后台管理系统webpack打包优化 | hackftz</title><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/fonts.css><link rel=stylesheet href=https://hackftz.github.io/css/theme-override.css><header><nav><ul><li class=pull-left><a href=https://hackftz.github.io/>~/hackftz</a></li><li class=pull-left><a href=/categories/>~/categories</a></li><li class=pull-left><a href=/tags/>~/tags</a></li><li class=pull-right><a href=https://github.com/hackftz>~/github</a></li></ul></nav></header></head><body><br><div class=article-meta><h1><span class=title>2020-12-04-记录一次vuecli3后台管理系统webpack打包优化</span></h1><h2 class=author>hackftz</h2><h2 class=date>2020/12/04</h2><p class=terms>Categories: <a href=/categories/webpack>webpack</a> <a href=/categories/vue>vue</a>
Tags: <a href=/tags/2020-12>2020-12</a></p></div><div class=content-wrapper><main><h4 id=一优化点>一、优化点</h4><ol><li>tree-shaking测试 webpack4以上默认配置 无须修改</li><li>开发环境下 速度测试(speed-measure-webpack-plugin)和打包分析(webpack-bundle- analyzer)，预发布及正式环境须去除</li><li>element ui 按需引入</li><li>echarts 按需引入</li><li>moment 按需引入 只引入zh-cn部分</li><li>去除jquery相关无用代码 及无用导出函数</li><li>添加thread-loader 启用多进程打包 加快打包速度</li><li>添加TerserWebpackPlugin 开启并行压缩js代码 去除正式环境下的console、debug</li><li>环境部署问题排查 项目配置修改 测试环境部署测试 最终定位到是环境问题</li><li>edu-ops-front 项目 更新环境node版本从8.11.1到10.16.2</li><li>删除了部分废弃代码文件</li></ol><p>结果：在不影响系统功能的情况下，测试环境下构建gzipped主包体积缩小了66.12%，正式环境下构建gzipped体积减少了18.37%，本地开发机器测试数据如下：</p><p>测试环境下：dist/index.js</p><table><thead><tr><th></th><th>size</th><th>gzipped</th></tr></thead><tbody><tr><td>优化前</td><td>32674.98kb</td><td>6320.37kb</td></tr><tr><td>优化后</td><td>6320.37kb</td><td>2141.28kb</td></tr></tbody></table><p>正式环境下：包含dist/js/chunk-vendors.js 、dist/js/index.js 、dist/css/chunk-vendors.css、dist/css/index.css</p><table><thead><tr><th></th><th>size</th><th>gzipped</th></tr></thead><tbody><tr><td>优化前</td><td>4757.82kb</td><td>4024.82kb</td></tr><tr><td>优化后</td><td>1434.74kb</td><td>1171.19kb</td></tr></tbody></table><h3 id=二记录点踩坑点>二、记录点（踩坑点）：</h3><ol><li><p>打包分析在jenkins环境下，是不可用的，构建完成后会启动http server，会导致部署成功，但是部署成功的状态一直卡住，无法回调，须在本地进行包构建分析，部署时去除分析、速度测试相关代码。</p></li><li><p>jenkins环境配置 node 8.11.1 版本过低，采用TerserWebpackPlugin构建时，node8会对node_modules代码进行严格校验，发现terser-webpack-plugin v5.0.3依赖的p-limit源码中存在代码语法错误，导致node8部署失败。经过对环境node版本升级到v10.16.2后，问题解决。</p></li><li><p>打包时间和包体积这两点上的优化是需要权衡的，通过更多配置更多插件去压缩包体积会延长打包时间，减少大体积文件的构建时间最好的方法是使用cdn替换，压缩体积最好的方法是对包做好分类，再进行细节优化。</p></li></ol><h3 id=三可加强点>三、可加强点</h3><ol><li>部分大体积资源可通过配置用cdn来替换，通过网络请求加载来减少部署构建时间。——公司cdn是否有稳定源？</li><li>废弃文件定位 清理</li><li>本地资源清理</li><li>不同浏览器的兼容问题——动态引入polyfill</li><li>分包打包，减少单页面资源请求大小</li></ol><a href=/>>> Home</a></main></div><footer><script>(function(){function center_el(tagName){var tags=document.getElementsByTagName(tagName),i,tag;for(i=0;i<tags.length;i++){tag=tags[i];var parent=tag.parentElement;if(parent.childNodes.length===1){if(parent.nodeName==='A'){parent=parent.parentElement;if(parent.childNodes.length!=1)continue;}
if(parent.nodeName==='P')parent.style.textAlign='center';}}}
var tagNames=['img','embed','object'];for(var i=0;i<tagNames.length;i++){center_el(tagNames[i]);}})();</script><hr>公众号: KeepinJS | <a href=mailto:472849306@qq.com>Email</a></footer></body></html>